#!/usr/bin/env python3
from flask import Flask, render_template, request

app = Flask(__name__)

def bytes_to_int(bs):
    n = 0

    for b in bs:
        n *= 256
        n |= b

    return n

def rsa_encrypt(m, e, n):
    return pow(m, e, n)

def rsa_decrypt(c, d, n):
    return pow(c, d, n)

e = 65537
d = 1366051689435661420230468979970866121682994554715175110183398575553108410584840141983521395616735477765999394598333349366305785903078855949856596225803768279309061067229485944092819608791156884277933684703693903348122165369299068000508100037671574557813268870698817828861341316351860202970294509560845820119090670164142755502416150509200013056050234269395826003234339703754529808772854928568180705756538527612203575709083696829539101294949026785736387100659773238433553899392866668574641548262920129112549649524889048789324787166308042970476556179587487065212260205338483588792913086535004180909279586866436335666177
n = 18451551848834489385334757943188510514579227974519462324008531007012379617580104778477749733003708368992230487178683577374192557858631282437294259449814831352241948714554579620365028586427462639102007397861910004889918044478102436015931441090041628564593611289981126143875870950072518986410591771040633246732515130254122011364555287584370332661505200616576812590158136780699424421415050268681116836070372355592799667329369754305258701881829815439845157653412486029908626559606053466186720757705161022626720104436569944306849573169525017120849115155112254578534505216173634147911469874217178526787810786801464089151661
flag = bytes_to_int(b"FLAG-8215bb728cb94313179ba81472bfd491")
encrypted_flag = rsa_encrypt(flag, e, n)
forbidden = [encrypted_flag]

@app.route("/")
def index():
    return render_template("index.html", flag=encrypted_flag)

@app.route("/decrypt")
def decrypt():
    message = request.args.get("message")
    message = int(message) % n

    if message in forbidden:
        return "Forbidden message"

    return str(rsa_decrypt(message, d, n))